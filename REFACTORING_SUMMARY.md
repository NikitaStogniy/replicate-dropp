# –û—Ç—á–µ—Ç –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–µ–∫—Ç–∞

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –§–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã:
- `app/containers/GeneratorForm.tsx` (176 —Å—Ç—Ä–æ–∫) - –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ DynamicGeneratorForm

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:
- `app/api/generate/utils.ts` (145 —Å—Ç—Ä–æ–∫) - utility —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è API
- `app/utils/formDataUtils.ts` (55 —Å—Ç—Ä–æ–∫) - schema-driven FormData

### –§–∞–π–ª—ã —É–ø—Ä–æ—â–µ–Ω—ã:

| –§–∞–π–ª | –ë—ã–ª–æ —Å—Ç—Ä–æ–∫ | –°—Ç–∞–ª–æ —Å—Ç—Ä–æ–∫ | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ |
|------|-----------|------------|-----------|
| `app/api/generate/route.ts` | 366 | 98 | **-73%** |
| `app/store/slices/generatorSlice.ts` | 167 | 55 | **-67%** |
| `app/store/index.ts` | 39 | 25 | **-36%** |

**–ò—Ç–æ–≥–æ —É–¥–∞–ª–µ–Ω–æ: ~400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. ‚ú® –£–ø—Ä–æ—â–µ–Ω–∏–µ Redux Store
**–ë—ã–ª–æ:**
```typescript
interface GeneratorState {
  parameters: Record<string, unknown>;
  resultsByModel: Record<string, GenerationResult>;

  // DEPRECATED: 11 legacy –ø–æ–ª–µ–π
  prompt: string;
  characterImage: File | null;
  imageInputs: ImageInputItem[];
  // ... –∏ –µ—â–µ 8 –ø–æ–ª–µ–π
}
```

**–°—Ç–∞–ª–æ:**
```typescript
interface GeneratorState {
  parameters: Record<string, unknown>;
  resultsByModel: Record<string, GenerationResult>;
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- ‚úÖ –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚úÖ –£–±—Ä–∞–Ω—ã serializableCheck –∏–≥–Ω–æ—Ä—ã –¥–ª—è File

---

### 2. üîß –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ API Route

**–ë—ã–ª–æ:** 366 —Å—Ç—Ä–æ–∫ —Å:
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ if/else –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
- –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–º—Å—è –∫–æ–¥–æ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–º–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–ª—É—á–∞—è–º–∏
- –°–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ output

**–°—Ç–∞–ª–æ:** 98 —Å—Ç—Ä–æ–∫ —Å:
- Schema-driven –ø–æ–¥—Ö–æ–¥ —á–µ—Ä–µ–∑ `buildApiInput()`
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ `processReplicateOutput()`
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ utility —Ñ—É–Ω–∫—Ü–∏—è—Ö

**–ù–æ–≤—ã–µ utilities:**
```typescript
// app/api/generate/utils.ts
- toBase64DataUrl() - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è File ‚Üí base64
- buildApiInput() - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ input –∏–∑ FormData + schema
- processReplicateOutput() - –æ–±—Ä–∞–±–æ—Ç–∫–∞ Replicate –æ—Ç–≤–µ—Ç–æ–≤
- handleSeed() - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è seed
```

---

### 3. üì¶ Schema-Driven FormData

**–°–æ–∑–¥–∞–Ω–æ:**
```typescript
// app/utils/formDataUtils.ts
export function schemaToFormData(
  model: ModelConfig,
  parameters: Record<string, unknown>
): FormData
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ FormData –∏–∑ schema
- –ù–µ—Ç —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–ª–µ–π
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏

---

### 4. üéØ –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ë–´–õ–û:                           –°–¢–ê–õ–û:
UI ‚Üí Legacy Actions             UI ‚Üí setParameter()
  ‚Üì                               ‚Üì
Legacy Fields ‚Üê Parameters      Parameters (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫)
  ‚Üì                               ‚Üì
Manual FormData                 schemaToFormData()
  ‚Üì                               ‚Üì
API —Å if/else                   buildApiInput() (schema-driven)
```

---

## üîÑ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–ó–∞–º–µ–Ω–∏—Ç—å File –Ω–∞ base64 –≤ Redux**
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å File ‚Üí base64 –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ store
   - –£–ª—É—á—à–∏—Ç persist/rehydrate

2. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å useGenerationHandler**
   - –ü—Ä–∏–Ω–∏–º–∞—Ç—å –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –≤–º–µ—Å—Ç–æ 13 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å schemaToFormData()

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
3. **TypeScript improvements**
   - –£–±—Ä–∞—Ç—å `as unknown as` casts
   - –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–ª—è parameters

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å useMemo/useCallback
   - React.memo –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üéâ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (legacy + parameters)
‚ùå 366 —Å—Ç—Ä–æ–∫ –≤ API route —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º—Å—è –∫–æ–¥–æ–º
‚ùå –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FormData
‚ùå –•–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
‚ùå File –æ–±—ä–µ–∫—Ç—ã –≤ Redux —Ç—Ä–µ–±—É—é—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (—Ç–æ–ª—å–∫–æ parameters)
‚úÖ 98 —Å—Ç—Ä–æ–∫ –≤ API route —Å utility —Ñ—É–Ω–∫—Ü–∏—è–º–∏
‚úÖ Schema-driven –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–µ–ª–µ–π
‚úÖ –ß–∏—Å—Ç—ã–π Redux store

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π** —Å—Ç–∞–ª–æ –ø—Ä–æ—â–µ:
   - –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π schema
   - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ utility —Ñ—É–Ω–∫—Ü–∏–∏
   - –î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è API route

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –û–±–Ω–æ–≤–∏—Ç—å README —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å schema extensions (x-ui-field, x-api-field)

---

## üí° –í—ã–≤–æ–¥—ã

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ:
- **–£–ø—Ä–æ—Å—Ç–∏–ª** –∫–æ–¥ –Ω–∞ 400+ —Å—Ç—Ä–æ–∫
- **–£–ª—É—á—à–∏–ª** maintainability —á–µ—Ä–µ–∑ schema-driven –ø–æ–¥—Ö–æ–¥
- **–£–±—Ä–∞–ª** –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥
- **–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:
- DRY (Don't Repeat Yourself)
- Single Source of Truth
- Schema-Driven Development
- Clean Architecture
